<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Veliki Merlin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --magic-purple: #9d4edd;
            --magic-gold: #ffdf00;
        }

        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle, #1a002e, #000000);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            color: white; overflow: hidden;
            height: 100vh; width: 100vw;
            display: flex; flex-direction: column; align-items: center;
            transition: background 2s ease;
        }

        body.magic-active { background: radial-gradient(circle, #4b0082, #000000); }

        /* MAGIƒåNI BLJESAK (BUM) */
        #flash-bang {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 100;
        }
        .flash-anim { animation: flashEffect 0.5s ease-out; }
        @keyframes flashEffect {
            0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; }
        }

        /* MERLIN KONTEJNER */
        .merlin-container {
            position: relative; width: 100%; height: 280px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .hat {
            font-size: 220px; color: var(--magic-purple);
            filter: drop-shadow(0 0 30px var(--magic-purple));
            animation: float 3s infinite ease-in-out;
            position: absolute; top: 10px;
        }

        .eyes-box { display: flex; gap: 40px; margin-bottom: 20px; z-index: 5; }
        .eye {
            width: 70px; height: 70px; background: white; border-radius: 50%;
            position: relative; border: 5px solid #000; overflow: hidden;
        }
        .eye::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 0%;
            background: var(--magic-purple); z-index: 10;
        }
        .blinking .eye::after { animation: blinkAnim 3.5s infinite; }
        .pupil {
            width: 30px; height: 30px; background: #000; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        /* KOLUTANJE OƒåIMA */
        .rolling-eyes .pupil { animation: rollAnim 0.6s infinite linear; }
        @keyframes rollAnim {
            from { transform: translate(-50%, -50%) rotate(0deg) translateY(-20px) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg) translateY(-20px) rotate(-360deg); }
        }
        .magic-eyes .eye { box-shadow: 0 0 30px var(--magic-gold); border-color: var(--magic-gold); }

        .interaction-zone {
            width: 95%; max-width: 800px;
            display: flex; flex-direction: column; align-items: center;
            text-align: center; margin-top: 5px;
        }

        #merlin-sentence {
            font-size: 2.4rem; font-weight: 800; line-height: 1.2;
            opacity: 0; transition: opacity 0.5s ease;
            min-height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .viking-size { font-size: 3.8rem; color: var(--magic-gold); text-transform: uppercase; }
        .example-text {
            display: block; font-size: 1.6rem; color: #ccc; margin-top: 15px;
            background: rgba(255, 255, 255, 0.1); padding: 5px 15px; border-radius: 15px;
        }

        /* MLIN I ZUPƒåANICI */
        .mill-box { display: none; justify-content: center; gap: 10px; margin: 15px 0; }
        .cog { font-size: 55px; color: var(--magic-gold); }
        .cog-right { animation: rotateMlin 2s infinite linear; }
        .cog-left { animation: rotateMlinRev 2s infinite linear; margin-right: -10px; }

        /* GRID SA SIMBOLIMA */
        .symbol-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 12px; max-height: 350px; overflow-y: auto;
            background: rgba(0,0,0,0.6); padding: 15px; border-radius: 20px;
            border: 3px solid var(--magic-purple); display: none;
        }
        .sym-card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,215,0,0.3);
            border-radius: 12px; padding: 10px; display: flex; flex-direction: column; align-items: center;
        }
        .sym-card .num { font-size: 1.2rem; color: var(--magic-gold); }
        .sym-card .icon { font-size: 2.2rem; }

        /* FINALNA ≈ΩIVOTINJA */
        #final-res { 
            font-size: 250px; display: none; 
            filter: drop-shadow(0 0 60px var(--magic-gold)); 
            line-height: 1; margin-top: -100px;
        }
        .final-pop { animation: finalPopAnim 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.5) forwards; }

        /* DUGME */
        .btn-magic {
            background: var(--magic-gold); color: #000; border: none;
            padding: 18px 45px; font-size: 2rem; font-weight: 900;
            border-radius: 80px; cursor: pointer; box-shadow: 0 8px 0 #b89b00;
            display: none; text-transform: uppercase; margin-top: 20px;
            transition: opacity 0.3s;
        }
        .btn-magic.show { display: block; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .btn-magic:disabled { opacity: 0.6; cursor: default; box-shadow: none; transform: translateY(4px); }

        /* ANIMACIJE */
        @keyframes finalPopAnim {
            0% { transform: scale(0) rotate(-20deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }
        @keyframes blinkAnim { 0%, 90%, 100% { height: 0%; } 93%, 97% { height: 100%; } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        @keyframes rotateMlin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes rotateMlinRev { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
    </style>
</head>
<body>

    <div id="flash-bang"></div>

    <div id="merlin-character" class="merlin-container">
        <div class="hat"><i class="fas fa-hat-wizard"></i></div>
        <div id="merlin-eyes-box" class="eyes-box blinking">
            <div class="eye"><div id="p1" class="pupil"></div></div>
            <div class="eye"><div id="p2" class="pupil"></div></div>
        </div>
    </div>

    <div class="interaction-zone">
        <div id="merlin-sentence"></div>
        <div id="magic-mill" class="mill-box">
            <i class="fas fa-cog cog cog-left"></i>
            <i class="fas fa-cog cog cog-right"></i>
        </div>
        <div id="grid-box" class="symbol-grid"></div>
        <div id="final-res"></div>
        <button id="main-btn" class="btn-magic" onclick="handleBtnClick()"></button>
    </div>

    <script>
        const sentenceEl = document.getElementById('merlin-sentence');
        const millEl = document.getElementById('magic-mill');
        const btn = document.getElementById('main-btn');
        const grid = document.getElementById('grid-box');
        const finalRes = document.getElementById('final-res');
        const eyesBox = document.getElementById('merlin-eyes-box');
        const flash = document.getElementById('flash-bang');
        const merlinChar = document.getElementById('merlin-character');

        let symbols = ['üê∂', 'üêØ', 'ü¶Ñ', 'üê∏', 'üêº', 'üçé', 'üöÄ', 'üåà', 'üç¶', 'üçï', 'üéÅ', 'üéà', 'üé®', 'ü¶Å', '‚≠ê', 'ü¶ñ', '‚öΩ', 'üíé', 'üçÑ', 'üçî'];
        let magicEmoji = symbols[Math.floor(Math.random() * symbols.length)];
        let currentAct = 0;
        let lineIndex = 0;
        let isRolling = false;

        function getWaitTime(text) {
            const baseTime = 1300;
            const perCharTime = 70;
            return baseTime + (text.length * perCharTime);
        }

        const acts = [
            { lines: ["≈†≈°≈°≈°≈°≈°...", "Ja sam <span class='viking-size'>VELIKI</span> Merlin!", "Gledaƒáu u tvoje misli!"], btn: "KRENI! ‚ñ∂Ô∏è" },
            { lines: ["Zamisli jedan <span class='viking-size'>DVOCIFRENI</span> broj."], btn: "ZAMISLIO SAM! ü§î", needsWait: true },
            {
                isMath: true,
                lines: [
                    { t: "Sada taj broj ubaci u moj <br><span class='viking-size'>MAGIƒåNI MLIN</span>", auto: true },
                    { t: "On ƒáe ga samleti u prah...", auto: true },
                    { t: "I stvoriti tvoj <br><span class='viking-size'>NOVI MAGIƒåNI BROJ!</span>", auto: true },
                    { t: "Hajde, sada da raƒçunamo", auto: true },
                    { t: "Saberi cifre tvog broja", ex: "Primer: 12 -> 1+2 = 3", auto: false, b: "DALJE ‚û°Ô∏è" },
                    { t: "I sad taj zbir oduzmi od tvog broja", ex: "Primer: 12 - 3 = 9", auto: false, b: "DALJE ‚û°Ô∏è" },
                    { t: "Tako je! Mlin je zavr≈°io posao...", auto: true },
                    { t: "I zapamti taj novi broj!", auto: false, b: "ZAPAMTIO SAM! ‚ú®" }
                ]
            },
            { lines: ["Pogledaj u <span class='viking-size'>VELIKI</span> zid!", "Zapamti sliku u kockici <br>pored tvog broja."], btn: "ZAPAMTIO SAM! üñºÔ∏è", showGrid: true },
            {
                isVision: true,
                lines: ["A sada... TI≈†INA.", "Va≈°e misli su <span class='viking-size'>OGROMNE</span>!", "Vidim...", "Vidiim..."]
            }
        ];

        async function playAct(actIndex) {
            btn.classList.remove('show');
            const act = acts[actIndex];
            lineIndex = 0;
            millEl.style.display = "none";
            grid.style.display = "none";
            sentenceEl.style.display = "flex";

            if (act.isMath) {
                millEl.style.display = "flex";
                runMathStep();
            } else if (act.isVision) {
                document.body.classList.add('magic-active');
                eyesBox.classList.remove('blinking');
                eyesBox.classList.add('magic-eyes', 'rolling-eyes');
                isRolling = true;
                for (let i = 0; i < act.lines.length; i++) {
                    sentenceEl.style.opacity = "0";
                    await new Promise(r => setTimeout(r, 450));
                    sentenceEl.innerHTML = `<span>${act.lines[i]}</span>`;
                    sentenceEl.style.opacity = "1";
                    await new Promise(r => setTimeout(r, getWaitTime(act.lines[i])));
                }
                revealFinal();
            } else {
                for (let i = 0; i < act.lines.length; i++) {
                    sentenceEl.style.opacity = "0";
                    await new Promise(r => setTimeout(r, 450));
                    sentenceEl.innerHTML = `<span>${act.lines[i]}</span>`;
                    sentenceEl.style.opacity = "1";
                    await new Promise(r => setTimeout(r, getWaitTime(act.lines[i])));
                }
                showFinalBtn(act);
            }
        }

        async function runMathStep() {
            btn.classList.remove('show');
            const act = acts[currentAct];
            const line = act.lines[lineIndex];
            sentenceEl.style.opacity = "0";
            await new Promise(r => setTimeout(r, 350));
            let content = `<span>${line.t}</span>`;
            if(line.ex) content += `<span class="example-text">${line.ex}</span>`;
            sentenceEl.innerHTML = content;
            sentenceEl.style.opacity = "1";
            if (line.auto) {
                await new Promise(r => setTimeout(r, getWaitTime(line.t)));
                lineIndex++;
                runMathStep();
            } else {
                setTimeout(() => { btn.innerText = line.b; btn.classList.add('show'); }, 1000);
            }
        }

        function showFinalBtn(act) {
            sentenceEl.style.opacity = "0";
            setTimeout(() => {
                if(act.showGrid) { renderGrid(); grid.style.display = "grid"; sentenceEl.style.display = "none"; }
                btn.innerText = act.btn;
                btn.classList.add('show');
                if(act.needsWait) {
                    btn.disabled = true;
                    setTimeout(() => { btn.disabled = false; }, 2000);
                } else { btn.disabled = false; }
            }, 500);
        }

        function handleBtnClick() {
            if (currentAct === 99) { location.reload(); return; }
            const act = acts[currentAct];
            if (act.isMath && lineIndex < act.lines.length - 1) {
                lineIndex++;
                runMathStep();
            } else {
                if (currentAct < acts.length - 1) {
                    currentAct++;
                    playAct(currentAct);
                }
            }
        }

        function renderGrid() {
            grid.innerHTML = '';
            for(let i=0; i<100; i++) {
                const s = (i % 9 === 0) ? magicEmoji : symbols[Math.floor(Math.random() * symbols.length)];
                grid.innerHTML += `<div class="sym-card"><div class="num">${i}</div><div class="icon">${s}</div></div>`;
            }
        }

        async function revealFinal() {
            sentenceEl.style.opacity = "0";
            await new Promise(r => setTimeout(r, 600));
            flash.classList.add('flash-anim');
            setTimeout(() => {
                merlinChar.style.opacity = "0";
                merlinChar.style.transform = "scale(0.5)";
                sentenceEl.style.display = "none";
                finalRes.innerText = magicEmoji;
                finalRes.style.display = "block";
                finalRes.classList.add('final-pop');
            }, 250);
            setTimeout(() => { 
                btn.innerText = "PONOVO üîÑ"; 
                btn.classList.add('show'); 
                btn.disabled = false;
                document.body.classList.remove('magic-active');
                currentAct = 99;
            }, 4500);
        }

        window.onload = () => playAct(0);
        setInterval(() => {
            if(!isRolling) {
                const p1 = document.getElementById('p1');
                const p2 = document.getElementById('p2');
                const x = (Math.random() - 0.5) * 20;
                const y = (Math.random() - 0.5) * 10;
                if(p1 && p2) {
                    p1.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                    p2.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                }
            }
        }, 2000);
    </script>
</body>
</html>
